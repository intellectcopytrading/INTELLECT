<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intellect CopyTrading</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@300;400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root{
  --bg:#060910;--s1:#0a0f18;--s2:#0d1520;--s3:#111d2a;
  --border:#162030;--border2:#1e2f42;
  --green:#00e5a0;--green2:#00b87a;--green3:#00ffa8;
  --text:#ddeeff;--muted:#4a7090;--muted2:#6a90b0;
  --red:#ff4560;--yellow:#ffc233;--blue:#38b6ff;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden}
body{background:var(--bg);color:var(--text);font-family:'IBM Plex Sans',sans-serif;display:flex;align-items:center;justify-content:center}

/* ‚îÄ‚îÄ GRID BG ‚îÄ‚îÄ */
body::before{content:'';position:fixed;inset:0;
  background-image:linear-gradient(rgba(0,229,160,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,160,.025) 1px,transparent 1px);
  background-size:60px 60px;pointer-events:none;z-index:0}
body::after{content:'';position:fixed;top:-200px;left:50%;transform:translateX(-50%);
  width:700px;height:500px;background:radial-gradient(ellipse,rgba(0,229,160,.07) 0%,transparent 70%);
  pointer-events:none;z-index:0}

/* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
.screen{position:fixed;inset:0;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:1;padding:1rem;overflow-y:auto}
.screen.active{display:flex}

/* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
.card{background:var(--s1);border:1px solid var(--border);border-radius:16px;padding:2.4rem 2rem;width:100%;max-width:460px;position:relative}
.card-wide{max-width:1100px}

/* ‚îÄ‚îÄ LOGO ‚îÄ‚îÄ */
.logo{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:3px;color:var(--green);text-align:center;margin-bottom:.3rem}
.logo span{color:var(--muted2)}
.logo-sub{font-family:'IBM Plex Mono',monospace;font-size:.6rem;letter-spacing:3px;color:var(--muted);text-align:center;margin-bottom:2rem}

/* ‚îÄ‚îÄ FORMS ‚îÄ‚îÄ */
.field{margin-bottom:1.1rem}
.field label{display:block;font-family:'IBM Plex Mono',monospace;font-size:.62rem;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:.4rem}
.field input,.field select{width:100%;background:var(--s2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'IBM Plex Mono',monospace;font-size:.8rem;padding:.65rem .9rem;outline:none;transition:border .2s}
.field input:focus,.field select:focus{border-color:var(--green2)}
.field select option{background:var(--s2)}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:.8rem}

.btn{width:100%;background:linear-gradient(135deg,var(--green2),var(--green));color:#060910;font-family:'IBM Plex Mono',monospace;font-size:.78rem;font-weight:600;letter-spacing:1px;border:none;border-radius:8px;padding:.8rem;cursor:pointer;transition:all .25s;margin-top:.5rem}
.btn:hover{opacity:.88;transform:translateY(-1px)}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--muted2)}
.btn-ghost:hover{border-color:var(--green2);color:var(--green)}
.btn-sm{padding:.5rem 1.2rem;width:auto;font-size:.7rem;margin-top:0}
.btn-danger{background:linear-gradient(135deg,#c0392b,var(--red));color:#fff}

.link{font-family:'IBM Plex Mono',monospace;font-size:.68rem;color:var(--muted);text-align:center;margin-top:1rem;cursor:pointer}
.link span{color:var(--green);cursor:pointer}
.link span:hover{text-decoration:underline}

.err{font-family:'IBM Plex Mono',monospace;font-size:.68rem;color:var(--red);margin-top:.4rem;display:none}
.err.show{display:block}

.divider{display:flex;align-items:center;gap:.8rem;margin:1.2rem 0}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border)}
.divider span{font-family:'IBM Plex Mono',monospace;font-size:.6rem;color:var(--muted);letter-spacing:2px}

/* ‚îÄ‚îÄ DASHBOARD LAYOUT ‚îÄ‚îÄ */
.app-layout{position:fixed;inset:0;display:none;z-index:1}
.app-layout.active{display:grid;grid-template-columns:220px 1fr;grid-template-rows:56px 1fr}

/* TOPBAR */
.topbar{grid-column:1/-1;background:rgba(6,9,16,.9);border-bottom:1px solid var(--border);backdrop-filter:blur(20px);display:flex;align-items:center;justify-content:space-between;padding:0 1.5rem}
.topbar-logo{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;color:var(--green)}
.topbar-logo span{color:var(--muted2)}
.topbar-user{display:flex;align-items:center;gap:.8rem;font-family:'IBM Plex Mono',monospace;font-size:.7rem;color:var(--muted2)}
.topbar-user .dot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green)}
.btn-logout{background:none;border:1px solid var(--border);border-radius:6px;color:var(--muted);font-family:'IBM Plex Mono',monospace;font-size:.65rem;padding:.3rem .7rem;cursor:pointer;transition:all .2s}
.btn-logout:hover{border-color:var(--red);color:var(--red)}

/* SIDEBAR */
.sidebar{background:var(--s1);border-right:1px solid var(--border);padding:1.2rem .8rem;display:flex;flex-direction:column;gap:.3rem;overflow-y:auto}
.nav-item{display:flex;align-items:center;gap:.6rem;padding:.6rem .8rem;border-radius:8px;border:1px solid transparent;cursor:pointer;font-family:'IBM Plex Mono',monospace;font-size:.72rem;color:var(--muted2);transition:all .2s}
.nav-item:hover{background:var(--s3);color:var(--text)}
.nav-item.active{background:rgba(0,229,160,.08);border-color:rgba(0,229,160,.2);color:var(--green)}
.nav-icon{font-size:1rem;width:18px;text-align:center}
.nav-divider{height:1px;background:var(--border);margin:.5rem 0}
.nav-label{font-size:.55rem;letter-spacing:3px;text-transform:uppercase;color:var(--muted);padding:.4rem .8rem}

/* MAIN CONTENT */
.main{overflow-y:auto;padding:1.5rem;display:flex;flex-direction:column;gap:1.2rem}

/* KPI GRID */
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.8rem}
.kpi{background:var(--s1);border:1px solid var(--border);border-radius:12px;padding:1.1rem 1.3rem;position:relative;overflow:hidden}
.kpi::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.kpi.g::before{background:linear-gradient(90deg,var(--green),transparent)}
.kpi.b::before{background:linear-gradient(90deg,var(--blue),transparent)}
.kpi.y::before{background:linear-gradient(90deg,var(--yellow),transparent)}
.kpi.r::before{background:linear-gradient(90deg,var(--red),transparent)}
.kpi-label{font-family:'IBM Plex Mono',monospace;font-size:.58rem;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:.4rem}
.kpi-val{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:1px;line-height:1}
.kpi-val.g{color:var(--green)}.kpi-val.b{color:var(--blue)}.kpi-val.y{color:var(--yellow)}.kpi-val.r{color:var(--red)}
.kpi-sub{font-family:'IBM Plex Mono',monospace;font-size:.58rem;color:var(--muted);margin-top:.3rem}

/* STATUS BADGE */
.badge{display:inline-flex;align-items:center;gap:.35rem;padding:.2rem .6rem;border-radius:4px;font-family:'IBM Plex Mono',monospace;font-size:.62rem;font-weight:600;letter-spacing:1px}
.badge.active-badge{background:rgba(0,229,160,.12);color:var(--green)}
.badge.inactive-badge{background:rgba(255,69,96,.12);color:var(--red)}
.badge.pending-badge{background:rgba(255,194,51,.12);color:var(--yellow)}
.badge-dot{width:5px;height:5px;border-radius:50%;background:currentColor}
.badge-dot.pulse{animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* CARDS */
.panel{background:var(--s1);border:1px solid var(--border);border-radius:12px;padding:1.3rem}
.panel-title{font-family:'IBM Plex Mono',monospace;font-size:.65rem;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:1rem;display:flex;justify-content:space-between;align-items:center}
.panels-row{display:grid;grid-template-columns:2fr 1fr;gap:1rem}

/* CHART */
.chart-wrap{height:200px}

/* INFO ROWS */
.info-row{display:flex;justify-content:space-between;align-items:center;padding:.55rem 0;border-bottom:1px solid var(--border2);font-size:.8rem}
.info-row:last-child{border-bottom:none}
.info-label{color:var(--muted2);font-weight:300}
.info-val{font-family:'IBM Plex Mono',monospace;font-weight:500;font-size:.78rem}

/* ADMIN TABLE */
.tbl-wrap{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:.72rem}
thead th{font-family:'IBM Plex Mono',monospace;font-size:.58rem;letter-spacing:2px;text-transform:uppercase;color:var(--muted);padding:.6rem .8rem;text-align:left;border-bottom:1px solid var(--border);white-space:nowrap}
tbody tr{border-bottom:1px solid var(--border2);transition:background .15s;cursor:pointer}
tbody tr:hover{background:var(--s2)}
tbody td{padding:.6rem .8rem;white-space:nowrap}

/* MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);z-index:100;display:none;align-items:center;justify-content:center;padding:1rem}
.modal-overlay.open{display:flex}
.modal{background:var(--s1);border:1px solid var(--border2);border-radius:16px;padding:2rem;width:100%;max-width:520px;max-height:90vh;overflow-y:auto}
.modal-title{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:2px;margin-bottom:1.5rem;color:var(--green)}
.modal-close{position:absolute;top:1rem;right:1rem;background:none;border:none;color:var(--muted);font-size:1.2rem;cursor:pointer;padding:.2rem .5rem}
.modal-close:hover{color:var(--red)}

/* TOAST */
.toast{position:fixed;bottom:1.5rem;right:1.5rem;background:var(--s3);border:1px solid var(--green2);border-radius:8px;padding:.7rem 1.2rem;font-family:'IBM Plex Mono',monospace;font-size:.7rem;color:var(--green);z-index:999;transform:translateY(20px);opacity:0;transition:all .3s;pointer-events:none}
.toast.show{transform:translateY(0);opacity:1}
.toast.err-toast{border-color:var(--red);color:var(--red)}

/* EMPTY STATE */
.empty{text-align:center;padding:3rem 1rem;color:var(--muted);font-family:'IBM Plex Mono',monospace;font-size:.72rem}
.empty-icon{font-size:2.5rem;margin-bottom:.8rem;opacity:.4}

/* SCROLLBAR */
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}

/* SECURITY NOTICE */
.sec-notice{background:rgba(255,194,51,.05);border:1px solid rgba(255,194,51,.15);border-radius:8px;padding:.7rem 1rem;font-family:'IBM Plex Mono',monospace;font-size:.62rem;color:#ffc233;margin-bottom:1.2rem;display:flex;gap:.5rem;align-items:flex-start;line-height:1.5}

/* MOBILE NAV */
.mobile-nav{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--s1);border-top:1px solid var(--border);z-index:50;padding:.5rem 0}
.mobile-nav-items{display:flex;justify-content:space-around;align-items:center}
.mobile-nav-item{display:flex;flex-direction:column;align-items:center;gap:.15rem;padding:.4rem .6rem;border-radius:8px;cursor:pointer;font-family:'IBM Plex Mono',monospace;font-size:.5rem;color:var(--muted);transition:all .2s;border:none;background:none;min-width:52px}
.mobile-nav-item.active{color:var(--green)}
.mobile-nav-item .mn-icon{font-size:1.2rem}

/* RESPONSIVE */
@media(max-width:700px){
  .app-layout.active{grid-template-columns:1fr;grid-template-rows:56px 1fr}
  .sidebar{display:none}
  .mobile-nav{display:block}
  .main{padding-bottom:5rem}
  .panels-row{grid-template-columns:1fr}
  .field-row{grid-template-columns:1fr}
}

/* ANIMATIONS */
@keyframes fadeInUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.card{animation:fadeInUp .4s ease both}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: CADASTRO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screenRegister">
  <div class="card" style="max-width:380px">
    <div class="logo">INTELLECT<span>CT</span></div>
    <div class="logo-sub" id="reg-plano-label">// CRIAR CONTA</div>
    <input type="password" style="display:none" tabindex="-1" aria-hidden="true">
    <div class="field">
      <label>Email</label>
      <input type="email" id="reg-email" placeholder="seu@email.com" autocomplete="off">
    </div>
    <div class="field">
      <label>Crie sua senha</label>
      <input type="password" id="reg-senha" placeholder="m√≠nimo 6 caracteres"
             autocomplete="new-password" oninput="checkSenhaMatch()" onkeydown="if(event.key==='Enter')doRegister()">
    </div>
    <div class="field">
      <label>Confirme sua senha</label>
      <input type="password" id="reg-senha2" placeholder="repita a senha"
             autocomplete="new-password" oninput="checkSenhaMatch()" onkeydown="if(event.key==='Enter')doRegister()">
      <div id="senha-match-msg" style="font-family:'IBM Plex Mono',monospace;font-size:.62rem;margin-top:.3rem;display:none"></div>
    </div>
    <div class="err" id="reg-err"></div>
    <button class="btn" onclick="doRegister()">CRIAR CONTA ‚Üí</button>
    <div class="link">J√° tem conta? <span onclick="showLogin()">Fazer login</span></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: LOGIN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen active" id="screenLogin">
  <div class="card" style="max-width:380px">
    <div class="logo">INTELLECT<span>CT</span></div>
    <div class="logo-sub">// √ÅREA DO CLIENTE</div>

    <div class="field">
      <label>Email</label>
      <input type="email" id="login-email" placeholder="seu@email.com" autocomplete="username">
    </div>
    <div class="field">
      <label>Senha</label>
      <input type="password" id="login-senha" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()">
    </div>
    <div class="err" id="login-err"></div>
    <button class="btn" onclick="doLogin()">ENTRAR ‚Üí</button>
    <div class="link">N√£o tem conta? <span onclick="showRegister()">Cadastrar agora</span></div>
    <div class="link" style="margin-top:.3rem"><span onclick="showAdminLogin()" style="color:var(--muted);font-size:.58rem">Acesso admin</span></div>

    <!-- HIDDEN ADMIN TRIGGER ‚Äî click logo 7x -->
    <div id="adminTrigger" onclick="adminClick()" style="position:absolute;top:0;left:0;width:60px;height:60px;cursor:default;opacity:0"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: ADMIN LOGIN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screenAdminLogin">
  <div class="card" style="max-width:360px">
    <div class="logo" style="color:var(--yellow)">INTELLECT<span style="color:var(--muted2)">ADMIN</span></div>
    <div class="logo-sub">// ACESSO RESTRITO</div>
    <div class="field">
      <label>Senha Admin</label>
      <input type="password" id="admin-pwd" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')doAdminLogin()">
    </div>
    <div class="err" id="admin-err"></div>
    <button class="btn" style="background:linear-gradient(135deg,#b8860b,var(--yellow));color:#060910" onclick="doAdminLogin()">ACESSAR ‚Üí</button>
    <div class="link"><span onclick="showLogin()">‚Üê Voltar</span></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     APP: DASHBOARD CLIENTE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="app-layout" id="appClient">
  <div class="topbar">
    <div class="topbar-logo">INTELLECT<span>CT</span></div>
    <div class="topbar-user">
      <div class="dot"></div>
      <span id="topbar-name">‚Äî</span>
      <a href="https://intellectcopytrading.github.io/LANDING/" target="_blank" style="font-family:'IBM Plex Mono',monospace;font-size:.62rem;color:var(--muted);text-decoration:none;border:1px solid var(--border);border-radius:6px;padding:.3rem .7rem;margin-right:.3rem">‚Üê LANDING</a>
      <button class="btn-logout" onclick="doLogout()">SAIR</button>
    </div>
  </div>
  <div class="sidebar">
    <div class="nav-label">Menu</div>
    <div class="nav-item active" onclick="clientTab('dashboard',this)"><span class="nav-icon">üìä</span>Dashboard</div>
    <div class="nav-item" onclick="clientTab('estrategias',this)"><span class="nav-icon">ü§ñ</span>Estrat√©gias</div>
    <div class="nav-item" onclick="clientTab('operacoes',this)"><span class="nav-icon">üìã</span>Opera√ß√µes</div>
    <div class="nav-item" onclick="clientTab('planos',this)"><span class="nav-icon">üí≥</span>Planos</div>
    <div class="nav-item" onclick="clientTab('conta',this)"><span class="nav-icon">üë§</span>Minha Conta</div>
    <div class="nav-divider"></div>
    <div class="nav-label">Suporte</div>
    <div class="nav-item" onclick="openWpp()"><span class="nav-icon">üí¨</span>WhatsApp</div>
  </div>
  <div class="main" id="clientMain"></div>
  <!-- MOBILE BOTTOM NAV -->
  <nav class="mobile-nav" id="mobileNav">
    <div class="mobile-nav-items">
      <button class="mobile-nav-item active" onclick="clientTabMobile('dashboard',this)"><span class="mn-icon">üìä</span>Dashboard</button>
      <button class="mobile-nav-item" onclick="clientTabMobile('estrategias',this)"><span class="mn-icon">ü§ñ</span>Estrat√©gias</button>
      <button class="mobile-nav-item" onclick="clientTabMobile('operacoes',this)"><span class="mn-icon">üìã</span>Opera√ß√µes</button>
      <button class="mobile-nav-item" onclick="clientTabMobile('conta',this)"><span class="mn-icon">üë§</span>Conta</button>
      <button class="mobile-nav-item" onclick="clientTabMobile('planos',this)"><span class="mn-icon">üí≥</span>Planos</button>
      <button class="mobile-nav-item" onclick="openWpp()"><span class="mn-icon">üí¨</span>Suporte</button>
    </div>
  </nav>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     APP: PAINEL ADMIN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="app-layout" id="appAdmin">
  <div class="topbar">
    <div class="topbar-logo" style="color:var(--yellow)">INTELLECT<span style="color:var(--muted2)">ADMIN</span></div>
    <div class="topbar-user">
      <div class="dot" style="background:var(--yellow);box-shadow:0 0 8px var(--yellow)"></div>
      <span>Matheus ¬∑ Admin</span>
      <button class="btn-logout" onclick="doLogout()">SAIR</button>
    </div>
  </div>
  <div class="sidebar">
    <div class="nav-label">Gest√£o</div>
    <div class="nav-item active" onclick="adminTab('clientes',this)"><span class="nav-icon">üë•</span>Clientes</div>
    <div class="nav-item" onclick="adminTab('novo',this)"><span class="nav-icon">‚ûï</span>Novo Cliente</div>
    <div class="nav-item" onclick="adminTab('estrategias',this)"><span class="nav-icon">ü§ñ</span>Estrat√©gias</div>
    <div class="nav-divider"></div>
    <div class="nav-label">Sistema</div>
    <div class="nav-item" onclick="adminTab('config',this)"><span class="nav-icon">‚öôÔ∏è</span>Configura√ß√µes</div>
  </div>
  <div class="main" id="adminMain"></div>
</div>


<!-- MODAL PAGAMENTO PLANO -->
<div class="modal-overlay" id="modalPagamentoPlano">
  <div class="modal" style="position:relative;max-width:440px">
    <button class="modal-close" onclick="fecharModalPlano()">‚úï</button>
    <div class="modal-title" id="modal-plano-title">ASSINAR PLANO</div>
    <div id="modal-plano-body"></div>
  </div>
</div>

<!-- MODAL EDITAR CLIENTE -->
<div class="modal-overlay" id="modalCliente">
  <div class="modal" style="position:relative">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <div class="modal-title" id="modal-title">DETALHES DO CLIENTE</div>
    <div id="modal-body"></div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUPABASE CONFIG ‚Äî substitua com suas credenciais
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SUPABASE_URL  = 'https://refmtoahyxldnyejwkwt.supabase.co';
const SUPABASE_KEY  = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJlZm10b2FoeXhsZG55ZWp3a3d0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIyNzg5NjgsImV4cCI6MjA4Nzg1NDk2OH0.zJwSQcP5_KMubQhyUvfrmGfPe-Gr-dAi8uLBiourWMg';
const ADMIN_PWD     = 'Cm2805..';

// Cliente HTTP Supabase (sem SDK, fetch puro)
const sb = {
  async get(table, filters = {}) {
    let url = `${SUPABASE_URL}/rest/v1/${table}?select=*`;
    for (const [k, v] of Object.entries(filters)) url += `&${k}=eq.${encodeURIComponent(v)}`;
    const r = await fetch(url, { headers: sbHeaders() });
    if (!r.ok) throw new Error(await r.text());
    return r.json();
  },
  async insert(table, data) {
    const r = await fetch(`${SUPABASE_URL}/rest/v1/${table}`, {
      method: 'POST',
      headers: { ...sbHeaders(), 'Prefer': 'return=representation' },
      body: JSON.stringify(data)
    });
    if (!r.ok) throw new Error(await r.text());
    return r.json();
  },
  async update(table, id, data) {
    const r = await fetch(`${SUPABASE_URL}/rest/v1/${table}?id=eq.${id}`, {
      method: 'PATCH',
      headers: { ...sbHeaders(), 'Prefer': 'return=representation' },
      body: JSON.stringify(data)
    });
    if (!r.ok) throw new Error(await r.text());
    return r.json();
  },
  async delete(table, id) {
    const r = await fetch(`${SUPABASE_URL}/rest/v1/${table}?id=eq.${id}`, {
      method: 'DELETE',
      headers: sbHeaders()
    });
    if (!r.ok) throw new Error(await r.text());
    return true;
  }
};

function sbHeaders() {
  return {
    'Content-Type': 'application/json',
    'apikey': SUPABASE_KEY,
    'Authorization': `Bearer ${SUPABASE_KEY}`
  };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SESSION (localStorage ‚Äî s√≥ guarda quem est√° logado)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getSession()      { try { return JSON.parse(localStorage.getItem('ict_session')); } catch { return null; } }
function saveSession(data) { localStorage.setItem('ict_session', JSON.stringify(data)); }
function clearSession()    { localStorage.removeItem('ict_session'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS SUPABASE (substitui fun√ß√µes de storage antigas)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function getClients() {
  try { return await sb.get('clientes'); } catch { return []; }
}
async function saveClients() { /* n√£o usada ‚Äî saves s√£o individuais */ }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function show(id) {
  document.querySelectorAll('.screen,.app-layout').forEach(el => {
    el.classList.remove('active');
  });
  document.getElementById(id).classList.add('active');
}
function showLogin()    { show('screenLogin'); }
function showRegister() { show('screenRegister'); }
function showAdminLogin(){ show('screenAdminLogin'); setTimeout(()=>document.getElementById('admin-pwd').focus(),100); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN HIDDEN TRIGGER (7 clicks on top-left corner)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let adminClicks = 0, adminTimer = null;
function adminClick() {
  adminClicks++;
  clearTimeout(adminTimer);
  adminTimer = setTimeout(() => { adminClicks = 0; }, 2000);
  if (adminClicks >= 7) { adminClicks = 0; showAdminLogin(); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REGISTER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function doRegister() {
  const email = document.getElementById('reg-email').value.trim().toLowerCase();
  const senha = document.getElementById('reg-senha').value;
  const errEl = document.getElementById('reg-err');
  const btn = document.querySelector('#screenRegister .btn');
  errEl.classList.remove('show');

  if (!email || !senha) { errEl.textContent='Preencha email e senha.'; errEl.classList.add('show'); return; }
  if (senha.length < 6)  { errEl.textContent='Senha m√≠nima de 6 caracteres.'; errEl.classList.add('show'); return; }

  btn.textContent = 'AGUARDE...'; btn.disabled = true;

  try {
    const [novo] = await sb.insert('clientes', {
      email, senha, nome:'', whats:'', plano:'', banca:0,
      bf_login:'', bf_senha:'', status:'Pendente', bot_ativo:false,
      roi:0, lucro:0, ops:0,
      vencimento: new Date(Date.now() + 30*24*60*60*1000).toISOString()
    });
    saveSession({ type:'client', id: novo.id, email });
    showToast('‚úì Conta criada!');
    loadClientDashboard(mapClient(novo));
    // Se veio de um plano, redireciona para aba Planos
    const planoUrl = new URLSearchParams(window.location.search).get('plano');
    if (planoUrl) {
      setTimeout(() => {
        const navPlanos = [...document.querySelectorAll('#appClient .nav-item')].find(el => el.textContent.includes('Planos'));
        if (navPlanos) clientTab('planos', navPlanos);
      }, 400);
    }
  } catch(e) {
    if (e.message.includes('duplicate') || e.message.includes('unique')) {
      errEl.textContent='Este email j√° est√° cadastrado. Fa√ßa login.';
    } else {
      errEl.textContent='Erro ao criar conta. Verifique sua conex√£o.';
    }
    errEl.classList.add('show');
    btn.textContent = 'CRIAR CONTA ‚Üí'; btn.disabled = false;
  }
}

function calcVencimento(plano) {
  const d = new Date();
  if (plano.includes('Anual')) d.setFullYear(d.getFullYear() + 1);
  else d.setMonth(d.getMonth() + 1);
  return d.toISOString();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOGIN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Mapeia snake_case do Supabase ‚Üí camelCase do app
function mapClient(r) {
  return {
    id: r.id, email: r.email, senha: r.senha,
    nome: r.nome||'', whats: r.whats||'', plano: r.plano||'',
    banca: r.banca||0, bfLogin: r.bf_login||'', bfSenha: r.bf_senha||'',
    status: r.status||'Pendente', botAtivo: r.bot_ativo||false,
    roi: r.roi||0, lucro: r.lucro||0, ops: r.ops||0,
    vencimento: r.vencimento||new Date().toISOString(),
    nota: r.nota||'', cadastro: r.cadastro||new Date().toISOString(),
    historico: []
  };
}

async function doLogin() {
  const email = document.getElementById('login-email').value.trim().toLowerCase();
  const senha = document.getElementById('login-senha').value;
  const errEl = document.getElementById('login-err');
  const btn   = document.querySelector('#screenLogin .btn');
  errEl.classList.remove('show');

  if (!email || !senha) { errEl.textContent='Preencha email e senha.'; errEl.classList.add('show'); return; }

  // Estado de carregamento
  btn.textContent = 'AGUARDE...';
  btn.disabled = true;

  try {
    const rows = await sb.get('clientes', { email });

    if (!rows || rows.length === 0) {
      errEl.textContent='Email n√£o encontrado. Verifique ou crie uma conta.';
      errEl.classList.add('show');
      btn.textContent='ENTRAR ‚Üí'; btn.disabled=false;
      return;
    }

    const client = rows.find(c => c.senha === senha);
    if (!client) {
      errEl.textContent='Senha incorreta.';
      errEl.classList.add('show');
      btn.textContent='ENTRAR ‚Üí'; btn.disabled=false;
      return;
    }

    // Buscar hist√≥rico
    const hist = await sb.get('historico', { cliente_id: client.id });
    const c = mapClient(client);
    c.historico = hist.map(h => ({ data: h.data, banca: h.banca, lucro: h.lucro, roi: h.roi }));

    saveSession({ type:'client', id: client.id, email });
    loadClientDashboard(c);
    conectarRealtime(client.id); // üî¥ LIVE
    pedirPermissaoNotificacao();
    // Se veio de um plano, redireciona para aba Planos
    const planoUrl = new URLSearchParams(window.location.search).get('plano');
    if (planoUrl) {
      setTimeout(() => {
        const navPlanos = [...document.querySelectorAll('#appClient .nav-item')].find(el => el.textContent.includes('Planos'));
        if (navPlanos) clientTab('planos', navPlanos);
      }, 400);
    }
  } catch(e) {
    console.error('Erro login:', e);
    errEl.textContent='Erro de conex√£o. Verifique sua internet e tente novamente.';
    errEl.classList.add('show');
    btn.textContent='ENTRAR ‚Üí'; btn.disabled=false;
  }
}

async function doAdminLogin() {
  const pwd   = document.getElementById('admin-pwd').value;
  const errEl = document.getElementById('admin-err');
  errEl.classList.remove('show');
  if (pwd !== ADMIN_PWD) { errEl.textContent='Senha incorreta.'; errEl.classList.add('show'); return; }
  saveSession({ type:'admin' });
  loadAdminPanel();
}

async function doLogout() {
  if (realtimeChannel) { realtimeChannel.close(); realtimeChannel = null; }
  clearSession();
  showLogin();
  document.getElementById('login-email').value='';
  document.getElementById('login-senha').value='';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLIENT DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentClient = null;
let chartInstance = null;

function loadClientDashboard(client) {
  currentClient = client;
  document.getElementById('topbar-name').textContent = client.nome.split(' ')[0];
  show('appClient');
  renderClientDashboard();
}

function clientTabMobile(tab, el) {
  document.querySelectorAll('#mobileNav .mobile-nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
  // Sync sidebar
  document.querySelectorAll('#appClient .nav-item').forEach(n => {
    n.classList.remove('active');
    if (n.textContent.toLowerCase().includes(tab === 'dashboard' ? 'dashboard' : tab === 'estrategias' ? 'estrat√©g' : tab === 'operacoes' ? 'opera√ß' : tab === 'planos' ? 'planos' : 'conta')) n.classList.add('active');
  });
  if (tab === 'dashboard') renderClientDashboard();
  else if (tab === 'estrategias') renderClientEstrategias();
  else if (tab === 'operacoes') renderClientOps();
  else if (tab === 'conta') renderClientConta();
  else if (tab === 'planos') renderClientPlanos();
}

function clientTab(tab, el) {
  document.querySelectorAll('#appClient .nav-item').forEach(n => n.classList.remove('active'));
  el.classList.add('active');
  if (tab === 'dashboard')    renderClientDashboard();
  else if (tab === 'estrategias') renderClientEstrategias();
  else if (tab === 'operacoes')   renderClientOps();
  else if (tab === 'conta')   renderClientConta();
  else if (tab === 'planos')  renderClientPlanos();
}

function renderClientDashboard() {
  const c  = currentClient;
  const vc = new Date(c.vencimento);
  const diasRestantes = Math.max(0, Math.round((vc - new Date()) / 86400000));
  const statusBadge = c.botAtivo
    ? `<span class="badge active-badge"><span class="badge-dot pulse"></span>BOT ATIVO</span>`
    : c.status === 'Pendente'
      ? `<span class="badge pending-badge"><span class="badge-dot"></span>AGUARDANDO CONFIG.</span>`
      : `<span class="badge inactive-badge"><span class="badge-dot"></span>BOT INATIVO</span>`;

  // Gr√°fico simulado a partir do hist√≥rico
  const hist = c.historico.length > 0 ? c.historico : gerarHistoricoDemo(c);

  const main = document.getElementById('clientMain');
  main.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem">
      <div>
        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:2px">MEU DASHBOARD</div>
        <div style="font-family:'IBM Plex Mono',monospace;font-size:.62rem;color:var(--muted)">${c.plano}</div>
      </div>
      ${statusBadge}
    </div>

    ${!c.nome || !c.bfLogin ? `
    <div style="background:rgba(255,194,51,.07);border:1px solid rgba(255,194,51,.2);border-radius:10px;padding:1rem 1.3rem;font-family:'IBM Plex Mono',monospace;font-size:.72rem;color:var(--yellow)">
      ‚ö†Ô∏è Cadastro incompleto ‚Äî preencha seus dados para ativar os bots. <span style="color:var(--green);cursor:pointer;text-decoration:underline" onclick="clientTab('conta', document.querySelectorAll('#appClient .nav-item')[2])">Completar agora ‚Üí</span>
    </div>` : ''}

    <div class="kpi-grid">
      <div class="kpi g">
        <div class="kpi-label">ROI no Per√≠odo</div>
        <div class="kpi-val g">${c.roi >= 0 ? '+' : ''}${c.roi.toFixed(1)}%</div>
        <div class="kpi-sub">desde o in√≠cio</div>
      </div>
      <div class="kpi g">
        <div class="kpi-label">Lucro em R$</div>
        <div class="kpi-val g">${c.lucro >= 0 ? '+' : ''}R$${c.lucro.toFixed(0)}</div>
        <div class="kpi-sub">banca inicial: R$${c.banca.toLocaleString('pt-BR')}</div>
      </div>
      <div class="kpi b">
        <div class="kpi-label">Opera√ß√µes</div>
        <div class="kpi-val b">${c.ops}</div>
        <div class="kpi-sub">registradas no per√≠odo</div>
      </div>
      <div class="kpi ${diasRestantes <= 7 ? 'r' : 'y'}">
        <div class="kpi-label">Vencimento do Plano</div>
        <div class="kpi-val ${diasRestantes <= 7 ? 'r' : 'y'}">${diasRestantes}d</div>
        <div class="kpi-sub">${vc.toLocaleDateString('pt-BR')}</div>
      </div>
    </div>

    <div class="panels-row">
      <div class="panel">
        <div class="panel-title">Evolu√ß√£o da Banca (R$)</div>
        <div class="chart-wrap"><canvas id="clientChart"></canvas></div>
      </div>
      <div class="panel">
        <div class="panel-title">Resumo da Conta</div>
        <div class="info-row"><span class="info-label">Plano</span><span class="info-val">${c.plano.split(' ¬∑')[0]}</span></div>
        <div class="info-row"><span class="info-label">Status</span><span class="info-val">${c.status}</span></div>
        <div class="info-row"><span class="info-label">Banca Inicial</span><span class="info-val">R$${Number(c.banca).toLocaleString('pt-BR')}</span></div>
        <div class="info-row"><span class="info-label">Banca Atual</span><span class="info-val" style="color:var(--green)">R$${(Number(c.banca) + c.lucro).toLocaleString('pt-BR')}</span></div>
        <div class="info-row"><span class="info-label">Cadastro</span><span class="info-val">${new Date(c.cadastro).toLocaleDateString('pt-BR')}</span></div>
        <div class="info-row"><span class="info-label">Vencimento</span><span class="info-val">${vc.toLocaleDateString('pt-BR')}</span></div>
      </div>
    </div>

    ${diasRestantes <= 7 ? `
    <div style="background:rgba(255,69,96,.07);border:1px solid rgba(255,69,96,.2);border-radius:10px;padding:1rem 1.3rem;font-family:'IBM Plex Mono',monospace;font-size:.72rem;color:var(--red)">
      ‚ö†Ô∏è Seu plano vence em <strong>${diasRestantes} dias</strong>. Entre em contato via WhatsApp para renovar e manter os bots ativos.
      <button class="btn btn-sm" style="margin-top:.7rem;background:linear-gradient(135deg,#c0392b,var(--red));color:#fff" onclick="openWpp()">RENOVAR AGORA</button>
    </div>` : ''}
  `;

  // Chart
  if (chartInstance) { chartInstance.destroy(); chartInstance = null; }
  const ctx = document.getElementById('clientChart').getContext('2d');
  chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: hist.map(h => h.data),
      datasets: [{
        data: hist.map(h => h.banca),
        borderColor: '#00e5a0',
        backgroundColor: 'rgba(0,229,160,.08)',
        borderWidth: 2,
        pointRadius: 2,
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false },
        tooltip: { backgroundColor: '#0d1520', borderColor: '#1e2f42', borderWidth: 1,
          titleColor: '#6a90b0', bodyColor: '#00e5a0',
          titleFont: { family: 'IBM Plex Mono', size: 10 },
          bodyFont: { family: 'IBM Plex Mono', size: 11 },
          callbacks: { label: ctx => ` R$ ${ctx.parsed.y.toFixed(0)}` }
        }
      },
      scales: {
        x: { grid: { color: 'rgba(22,32,48,.8)' }, ticks: { color: '#4a7090', font: { family: 'IBM Plex Mono', size: 9 }, maxTicksLimit: 6 } },
        y: { grid: { color: 'rgba(22,32,48,.8)' }, ticks: { color: '#4a7090', font: { family: 'IBM Plex Mono', size: 9 }, callback: v => 'R$'+v } }
      }
    }
  });
}

function gerarHistoricoDemo(c) {
  // Gera hist√≥rico simulado baseado no ROI/lucro do cliente
  const pts = 30;
  const result = [];
  let banca = Number(c.banca);
  const lucroTotal = c.lucro;
  for (let i = 0; i < pts; i++) {
    const d = new Date(); d.setDate(d.getDate() - (pts - i));
    const progresso = i / (pts - 1);
    const variacao = (Math.random() - 0.45) * (Math.abs(lucroTotal) * 0.08);
    banca = Number(c.banca) + (lucroTotal * progresso) + variacao;
    result.push({ data: d.toLocaleDateString('pt-BR', { day:'2-digit', month:'2-digit' }), banca: parseFloat(banca.toFixed(2)) });
  }
  return result;
}

function renderClientOps() {
  const c = currentClient;
  document.getElementById('clientMain').innerHTML = `
    <div style="font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:2px">OPERA√á√ïES</div>
    ${c.historico.length === 0 ? `
      <div class="panel"><div class="empty"><div class="empty-icon">üìã</div>Nenhuma opera√ß√£o registrada ainda.<br>Aguarde a configura√ß√£o dos bots.</div></div>
    ` : `
      <div class="panel">
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>Data</th><th>Banca</th><th>Lucro</th><th>ROI</th></tr></thead>
            <tbody>${c.historico.map(h=>`
              <tr>
                <td>${h.data}</td>
                <td style="font-family:'IBM Plex Mono',monospace">R$${h.banca?.toFixed(0)||'‚Äî'}</td>
                <td style="color:${(h.lucro||0)>=0?'var(--green)':'var(--red)'};font-family:'IBM Plex Mono',monospace">${(h.lucro||0)>=0?'+':''}R$${(h.lucro||0).toFixed(2)}</td>
                <td style="color:var(--blue);font-family:'IBM Plex Mono',monospace">${(h.roi||0).toFixed(1)}%</td>
              </tr>`).join('')}
            </tbody>
          </table>
        </div>
      </div>
    `}
  `;
}

function renderClientConta() {
  const c = currentClient;
  const isTelegram = c.plano && c.plano.includes('Telegram');
  const incompleto = !c.nome || !c.whats || !c.plano || (!isTelegram && !c.bfLogin);
  document.getElementById('clientMain').innerHTML = `
    <div style="font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:2px">MINHA CONTA</div>

    ${incompleto ? `
    <div style="background:rgba(255,194,51,.07);border:1px solid rgba(255,194,51,.2);border-radius:10px;padding:1rem 1.3rem;font-family:'IBM Plex Mono',monospace;font-size:.72rem;color:var(--yellow);margin-bottom:.2rem">
      ‚ö†Ô∏è Complete seu cadastro abaixo para ativar os bots. Nossa equipe ser√° notificada assim que voc√™ salvar.
    </div>` : ''}

    <div class="panel" style="max-width:540px">
      <div class="panel-title">Dados Pessoais</div>
      <div class="field"><label>Nome Completo</label><input type="text" id="p-nome" value="${c.nome||''}" placeholder="Seu nome completo"></div>
      <div class="field"><label>WhatsApp</label><input type="text" id="p-whats" value="${c.whats||''}" placeholder="(00) 00000-0000"></div>
      <div class="field"><label>Plano Desejado</label>
        <select id="p-plano" onchange="toggleBetfairCliente()">
          <option value="">Selecione seu plano...</option>
          <option value="Telegram - R$97/m√™s" ${c.plano==='Telegram - R$97/m√™s'?'selected':''}>Telegram ¬∑ R$97/m√™s</option>
          <option value="Bot por Estrat√©gia - R$117 + 10%" ${c.plano==='Bot por Estrat√©gia - R$117 + 10%'?'selected':''}>Bot por Estrat√©gia ¬∑ R$117 + 10% lucro</option>
          <option value="Anual - R$1.997 + 15%" ${c.plano==='Anual - R$1.997 + 15%'?'selected':''}>Anual ¬∑ R$1.997 + 15% lucro</option>
        </select>
      </div>
      ${!isTelegram ? `<div id="p-banca-wrap"><div class="field"><label>Banca Inicial na Betfair (R$)</label><input type="number" id="p-banca" value="${c.banca||''}" placeholder="Ex: 5000"></div></div>` : '<div id="p-banca-wrap" style="display:none"><div class="field"><label>Banca Inicial na Betfair (R$)</label><input type="number" id="p-banca" value="" placeholder="Ex: 5000"></div></div>'}
    </div>

    <div id="p-betfair-wrap" class="panel" style="max-width:540px${isTelegram ? ';display:none' : ''}">
      <div class="panel-title">üîë Acesso Betfair</div>
      <div class="sec-notice">üîí Seus dados s√£o criptografados e acessados apenas pela nossa equipe para configurar os bots.</div>
      <div class="field"><label>Login / Email Betfair</label><input type="email" id="p-bfl" value="${c.bfLogin||''}" placeholder="email@betfair.com"></div>
      <div class="field"><label>Senha Betfair</label><input type="password" id="p-bfs" value="${c.bfSenha||''}" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
    </div>

    <div class="panel" style="max-width:540px">
      <div class="panel-title">Seguran√ßa</div>
      <div class="field"><label>Email da Conta</label><input type="text" value="${c.email}" disabled style="opacity:.5"></div>
      <div class="field"><label>Nova Senha (deixe em branco para manter)</label><input type="password" id="p-newsenha" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
    </div>

    <div style="max-width:540px">
      <div class="err" id="p-err"></div>
      <button class="btn" onclick="saveProfile()" style="max-width:540px">üíæ SALVAR CADASTRO ‚Üí</button>
      <div style="margin-top:1rem">
        <button class="btn btn-ghost" onclick="openWpp()" style="max-width:540px">üí¨ FALAR COM SUPORTE</button>
      </div>
    </div>
  `;
}

async function saveProfile() {
  const nome    = document.getElementById('p-nome').value.trim();
  const whats   = document.getElementById('p-whats').value.trim();
  const plano   = document.getElementById('p-plano').value;
  const isTelegram = plano.includes('Telegram');
  const banca   = isTelegram ? 0 : parseFloat(document.getElementById('p-banca').value);
  const bfLogin = isTelegram ? '' : document.getElementById('p-bfl').value.trim();
  const bfSenha = isTelegram ? '' : document.getElementById('p-bfs').value;
  const newSenha= document.getElementById('p-newsenha').value;
  const errEl   = document.getElementById('p-err');
  errEl.classList.remove('show');

  if (!nome||!whats||!plano||(!isTelegram&&(isNaN(banca)||!bfLogin||!bfSenha))) {
    errEl.textContent='Preencha todos os campos obrigat√≥rios.'; errEl.classList.add('show'); return;
  }
  if (newSenha && newSenha.length < 6) {
    errEl.textContent='Nova senha m√≠nima de 6 caracteres.'; errEl.classList.add('show'); return;
  }

  const patch = { nome, whats, plano, banca, bf_login:bfLogin, bf_senha:bfSenha,
    vencimento: calcVencimento(plano) };
  if (newSenha) patch.senha = newSenha;

  try {
    const [updated] = await sb.update('clientes', currentClient.id, patch);
    currentClient = { ...currentClient, ...mapClient(updated) };
    document.getElementById('topbar-name').textContent = nome.split(' ')[0];
    showToast('‚úì Cadastro salvo! Nossa equipe ir√° configurar seus bots em breve.');
  } catch(e) {
    errEl.textContent='Erro ao salvar. Tente novamente.'; errEl.classList.add('show');
  }
}

function openWpp() {
  window.open('https://wa.me/5597991637163?text=Ol√°%20Matheus!%20Sou%20cliente%20e%20preciso%20de%20ajuda.', '_blank');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ESTRAT√âGIAS (VITRINE DE BOTS)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ESTRATEGIAS = [
  { id: 1, nome: 'Estrat√©gia 01', mercado: 'Over Gols', desc: 'Opera√ß√µes voltadas ao mercado de Over Gols. Alta frequ√™ncia de entradas com gest√£o automatizada de stake.', icone: '‚öΩ' },
  { id: 2, nome: 'Estrat√©gia 02', mercado: 'Under Gols', desc: 'Opera√ß√µes voltadas ao mercado de Under Gols. Ideal para jogos de baixo volume ofensivo.', icone: 'üõ°Ô∏è' },
  { id: 3, nome: 'Estrat√©gia 03', mercado: 'Match Odds', desc: 'Opera√ß√µes no mercado de Match Odds com an√°lise de valor esperado e automa√ß√£o completa.', icone: 'üéØ' },
];
const PIX_KEY   = '07bc03ad-72bf-41f1-bf4f-585bcbd2324e';
const WPP_ADMIN = '5597991637163';
const VALOR_BOT = 117;

function renderClientPlanos() {
  const c = currentClient;
  const planoAtual = c.plano || '';
  const isTelegram = planoAtual.includes('Telegram');
  const isBot = planoAtual.includes('Bot');
  const isAnual = planoAtual.includes('Anual');

  function card(opts) {
    const ativo = opts.ativo;
    const border = ativo ? opts.borderAtivo : opts.border || 'var(--border)';
    const shadow = ativo ? opts.shadowAtivo || '' : '';
    return '<div class="panel" style="border-color:' + border + ';' + shadow + '">'
      + (ativo ? '<div style="text-align:center;margin-bottom:.8rem"><span style="background:var(--green);color:#060910;font-family:IBM Plex Mono,monospace;font-size:.55rem;font-weight:700;padding:.2rem .8rem;border-radius:20px;letter-spacing:1px">PLANO ATUAL</span></div>' : '')
      + '<div style="font-family:IBM Plex Mono,monospace;font-size:.58rem;letter-spacing:3px;color:var(--muted);margin-bottom:.5rem">' + opts.tag + '</div>'
      + '<div style="font-family:Bebas Neue,sans-serif;font-size:1.4rem;letter-spacing:2px;color:var(--text);margin-bottom:.3rem">' + opts.nome + '</div>'
      + '<div style="font-family:Bebas Neue,sans-serif;font-size:2.2rem;color:' + opts.cor + ';line-height:1">' + opts.preco + '<span style="font-size:1rem;color:var(--muted2)">' + opts.periodo + '</span></div>'
      + '<div style="font-size:.65rem;color:var(--muted);margin-bottom:1.2rem">' + opts.sub + '</div>'
      + '<div style="display:flex;flex-direction:column;gap:.5rem;margin-bottom:1.5rem;font-size:.75rem;color:var(--muted2)">'
      + opts.items.map(function(i){ return '<div>‚úì ' + i + '</div>'; }).join('')
      + '</div>'
      + (ativo
        ? '<div class="btn btn-ghost" style="text-align:center;cursor:default">PLANO ATIVO ‚úì</div>'
        : '<button class="btn" style="' + (opts.btnStyle||'') + '" onclick="' + opts.onclick + '">' + opts.btnLabel + '</button>'
      )
      + '</div>';
  }

  const html = '<div style="max-width:860px;margin:0 auto">'
    + '<div style="font-family:IBM Plex Mono,monospace;font-size:.6rem;letter-spacing:3px;color:var(--muted);margin-bottom:.3rem">// ESCOLHA SEU PLANO</div>'
    + '<h2 style="font-family:Bebas Neue,sans-serif;font-size:1.8rem;letter-spacing:2px;color:var(--text);margin-bottom:.4rem">PLANOS E PRE√áOS</h2>'
    + '<p style="font-size:.8rem;color:var(--muted2);margin-bottom:2rem">Assine ou atualize seu plano. Taxa de performance cobrada <strong style="color:var(--green)">apenas quando houver lucro</strong>.</p>'
    + '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1.2rem">'
    + card({
        ativo: isTelegram, border: 'var(--border)', borderAtivo: 'var(--green)', shadowAtivo: 'box-shadow:0 0 20px rgba(0,229,160,.15)',
        tag: 'SINAIS', nome: 'PLANO TELEGRAM', preco: 'R$ 97', periodo: '/m√™s', cor: 'var(--green)', sub: 'sem taxa de performance',
        items: ['Sinais di√°rios no grupo privado','Todas as estrat√©gias validadas','Execute manualmente ou automatize','Ideal para conhecer o m√©todo'],
        onclick: "abrirModalPlano('Plano Telegram', 97, 'Acesso ao grupo privado com sinais di√°rios.')",
        btnLabel: 'ASSINAR AGORA ‚Üí'
      })
    + card({
        ativo: isBot, border: 'var(--green2)', borderAtivo: 'var(--green2)', shadowAtivo: 'box-shadow:0 0 20px rgba(0,229,160,.15)',
        tag: 'AUTOMA\u00c7\u00c3O', nome: 'BOT POR ESTRAT\u00c9GIA', preco: 'R$ 117', periodo: '/estrat\u00e9gia', cor: 'var(--green)', sub: '+ 10% sobre o lucro mensal',
        items: ['Escolha qual estrat√©gia ativar','Over Gols ¬∑ Under Gols ¬∑ Match Odds','Controle total pela √°rea do cliente','Sem lucro = sem cobran√ßa mensal'],
        onclick: "abrirModalPlano('Bot por Estrategia', 117, 'Ativa√ß√£o de uma estrat√©gia automatizada na sua conta Betfair.')",
        btnLabel: 'CONTRATAR ‚Üí'
      })
    + card({
        ativo: isAnual, border: 'var(--border)', borderAtivo: 'var(--yellow)', shadowAtivo: 'box-shadow:0 0 20px rgba(255,194,51,.15)',
        tag: 'COPYTRADING COMPLETO', nome: 'PLANO ANUAL', preco: 'R$ 1.997', periodo: '/ano', cor: 'var(--yellow)', sub: '+ 15% sobre o lucro ¬∑ R$166/m√™s',
        items: ['Todas as estrat√©gias ativas 24/7','Setup completo incluso','Relat√≥rios semanais no WhatsApp','Suporte especializado vital√≠cio','Acesso a novas estrat√©gias validadas'],
        onclick: "abrirModalPlano('Plano Anual', 1997, 'Todas as estrat√©gias ativas com setup completo incluso.')",
        btnLabel: 'ASSINAR AGORA ‚Üí', btnStyle: 'background:linear-gradient(135deg,#b8860b,var(--yellow));color:#060910'
      })
    + '</div>'
    + '<div style="margin-top:1.5rem;background:rgba(0,229,160,.05);border:1px solid rgba(0,229,160,.1);border-radius:10px;padding:1rem 1.2rem;font-family:IBM Plex Mono,monospace;font-size:.62rem;color:var(--muted);line-height:1.8">'
    + 'üí≥ Pagamento via PIX ¬∑ Ativa√ß√£o em at√© 24h √∫teis &nbsp;¬∑&nbsp; ‚ö° Sem lucro = sem cobran√ßa &nbsp;¬∑&nbsp; üìã D√∫vidas? <a href="https://wa.me/5597991637163" target="_blank" style="color:var(--green)">Fale no WhatsApp</a>'
    + '</div></div>';

  document.getElementById('clientMain').innerHTML = html;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showToast(msg, isErr = false) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast' + (isErr ? ' err-toast' : '');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOGGLE CAMPOS BETFAIR NA ABA CONTA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleBetfairCliente() {
  const plano = document.getElementById('p-plano').value;
  const isTelegram = plano.includes('Telegram');
  const bancaWrap   = document.getElementById('p-banca-wrap');
  const betfairWrap = document.getElementById('p-betfair-wrap');
  if (bancaWrap)   bancaWrap.style.display   = isTelegram ? 'none' : '';
  if (betfairWrap) betfairWrap.style.display = isTelegram ? 'none' : '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIRMA√á√ÉO DE SENHA NO CADASTRO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function checkSenhaMatch() {
  const s1  = document.getElementById('reg-senha').value;
  const s2  = document.getElementById('reg-senha2').value;
  const msg = document.getElementById('senha-match-msg');
  if (!s2) { msg.style.display = 'none'; return; }
  if (s1 === s2) {
    msg.style.display = 'block'; msg.style.color = 'var(--green)'; msg.textContent = '‚úì Senhas conferem';
  } else {
    msg.style.display = 'block'; msg.style.color = 'var(--red)'; msg.textContent = '‚úó Senhas n√£o conferem';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REGISTER ‚Äî vers√£o corrigida com confirma√ß√£o de senha
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function doRegister() {
  const email  = document.getElementById('reg-email').value.trim().toLowerCase();
  const senha  = document.getElementById('reg-senha').value;
  const senha2 = document.getElementById('reg-senha2').value;
  const errEl  = document.getElementById('reg-err');
  const btn    = document.querySelector('#screenRegister .btn');
  errEl.classList.remove('show');

  if (!email || !senha)  { errEl.textContent='Preencha email e senha.'; errEl.classList.add('show'); return; }
  if (senha.length < 6)  { errEl.textContent='Senha m√≠nima de 6 caracteres.'; errEl.classList.add('show'); return; }
  if (senha !== senha2)  { errEl.textContent='As senhas n√£o conferem.'; errEl.classList.add('show'); return; }

  btn.textContent = 'AGUARDE...'; btn.disabled = true;
  try {
    const [novo] = await sb.insert('clientes', {
      email, senha, nome:'', whats:'', plano:'', banca:0,
      bf_login:'', bf_senha:'', status:'Pendente', bot_ativo:false,
      roi:0, lucro:0, ops:0,
      vencimento: new Date(Date.now() + 30*24*60*60*1000).toISOString()
    });
    saveSession({ type:'client', id: novo.id, email });
    document.getElementById('reg-senha').value  = '';
    document.getElementById('reg-senha2').value = '';
    document.getElementById('reg-email').value  = '';
    showToast('‚úì Conta criada! Complete seu cadastro.');
    loadClientDashboard(mapClient(novo));
    const planoUrl = new URLSearchParams(window.location.search).get('plano');
    setTimeout(() => {
      const aba = planoUrl ? 'planos' : 'conta';
      const label = planoUrl ? 'Planos' : 'Conta';
      const nav = [...document.querySelectorAll('#appClient .nav-item')].find(el => el.textContent.includes(label));
      if (nav) clientTab(aba, nav);
    }, 500);
  } catch(e) {
    errEl.textContent = (e.message.includes('duplicate') || e.message.includes('unique'))
      ? 'Este email j√° est√° cadastrado. Fa√ßa login.'
      : 'Erro ao criar conta. Verifique sua conex√£o.';
    errEl.classList.add('show');
    btn.textContent = 'CRIAR CONTA ‚Üí'; btn.disabled = false;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ESTRAT√âGIAS ‚Äî aba do cliente
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderClientEstrategias() {
  const c = currentClient;
  const temAcesso = c.plano && (c.plano.includes('Anual') || c.plano.includes('Bot'));
  const cards = ESTRATEGIAS.map(e => `
    <div class="panel" style="border-color:${temAcesso && c.botAtivo ? 'var(--green)' : 'var(--border)'}">
      <div style="font-size:2rem;margin-bottom:.6rem">${e.icone}</div>
      <div style="font-family:'IBM Plex Mono',monospace;font-size:.58rem;letter-spacing:2px;color:var(--muted);margin-bottom:.3rem">${e.mercado}</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:2px;margin-bottom:.5rem">${e.nome}</div>
      <div style="font-size:.78rem;color:var(--muted2);margin-bottom:1rem;line-height:1.6">${e.desc}</div>
      ${temAcesso
        ? `<span class="badge ${c.botAtivo ? 'active-badge' : 'pending-badge'}"><span class="badge-dot ${c.botAtivo ? 'pulse' : ''}"></span>${c.botAtivo ? 'ATIVO' : 'AGUARDANDO CONFIG.'}</span>`
        : `<button class="btn btn-sm" onclick="clientTab('planos', document.querySelectorAll('#appClient .nav-item')[3])">CONTRATAR ‚Üí</button>`
      }
    </div>
  `).join('');
  document.getElementById('clientMain').innerHTML = `
    <div style="font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:2px">ESTRAT√âGIAS</div>
    <p style="font-size:.8rem;color:var(--muted2);margin-bottom:1rem">Bots automatizados operando 24/7 na sua conta Betfair.</p>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem">${cards}</div>
    ${!temAcesso ? `<div style="background:rgba(255,194,51,.06);border:1px solid rgba(255,194,51,.15);border-radius:10px;padding:1rem 1.2rem;font-family:'IBM Plex Mono',monospace;font-size:.68rem;color:var(--yellow);margin-top:.5rem">
      ‚ö° Voc√™ precisa de um plano Bot ou Anual para ativar as estrat√©gias. <span style="color:var(--green);cursor:pointer;text-decoration:underline" onclick="clientTab('planos', document.querySelectorAll('#appClient .nav-item')[3])">Ver planos ‚Üí</span>
    </div>` : ''}
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL PAGAMENTO PLANO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function abrirModalPlano(nomePlano, valor, descricao) {
  document.getElementById('modal-plano-title').textContent = 'ASSINAR ‚Äî ' + nomePlano.toUpperCase();
  document.getElementById('modal-plano-body').innerHTML = `
    <div style="background:rgba(0,229,160,.06);border:1px solid rgba(0,229,160,.15);border-radius:10px;padding:1rem 1.2rem;margin-bottom:1.2rem">
      <div style="font-family:'IBM Plex Mono',monospace;font-size:.62rem;color:var(--muted);margin-bottom:.3rem">PLANO SELECIONADO</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:1.4rem;color:var(--green)">${nomePlano}</div>
      <div style="font-size:.78rem;color:var(--muted2);margin-top:.3rem">${descricao}</div>
    </div>
    <div style="text-align:center;margin-bottom:1.2rem">
      <div style="font-family:'IBM Plex Mono',monospace;font-size:.62rem;color:var(--muted);margin-bottom:.5rem">VALOR A PAGAR</div>
      <div style="font-family:'Bebas Neue',sans-serif;font-size:2.5rem;color:var(--green)">R$ ${valor.toLocaleString('pt-BR')}</div>
      <div style="font-size:.7rem;color:var(--muted)">pagamento √∫nico via PIX</div>
    </div>
    <div style="background:var(--s2);border:1px solid var(--border);border-radius:10px;padding:1.2rem;margin-bottom:1.2rem;text-align:center">
      <div style="font-family:'IBM Plex Mono',monospace;font-size:.6rem;color:var(--muted);margin-bottom:.5rem">CHAVE PIX</div>
      <div style="font-family:'IBM Plex Mono',monospace;font-size:.75rem;color:var(--text);word-break:break-all;margin-bottom:.8rem">${PIX_KEY}</div>
      <button class="btn btn-sm" onclick="copiarPix()">üìã COPIAR CHAVE PIX</button>
    </div>
    <div style="font-family:'IBM Plex Mono',monospace;font-size:.65rem;color:var(--muted);line-height:2;margin-bottom:1.2rem">
      ‚ë† Fa√ßa o PIX para a chave acima<br>
      ‚ë° Envie o comprovante pelo WhatsApp<br>
      ‚ë¢ Ativa√ß√£o em at√© 24h √∫teis
    </div>
    <button class="btn" onclick="confirmarPagamentoWpp('${nomePlano}', ${valor})">
      üí¨ ENVIAR COMPROVANTE NO WHATSAPP ‚Üí
    </button>
  `;
  document.getElementById('modalPagamentoPlano').classList.add('open');
}

function fecharModalPlano() {
  document.getElementById('modalPagamentoPlano').classList.remove('open');
}

function copiarPix() {
  navigator.clipboard.writeText(PIX_KEY)
    .then(() => showToast('‚úì Chave PIX copiada!'))
    .catch(() => showToast('Copie: ' + PIX_KEY, true));
}

function confirmarPagamentoWpp(nomePlano, valor) {
  const nome = currentClient.nome || currentClient.email;
  const msg = encodeURIComponent(`Ol√° Matheus! Sou ${nome} e fiz o PIX de R$${valor} para o ${nomePlano}. Segue o comprovante:`);
  window.open(`https://wa.me/${WPP_ADMIN}?text=${msg}`, '_blank');
  fecharModalPlano();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODAL CLIENTE ADMIN ‚Äî fechar
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function closeModal() {
  document.getElementById('modalCliente').classList.remove('open');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REALTIME ‚Äî polling a cada 60s
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let realtimeChannel = null;
function conectarRealtime(clientId) {
  if (realtimeChannel) clearInterval(realtimeChannel);
  realtimeChannel = setInterval(async () => {
    try {
      const rows = await sb.get('clientes', { id: clientId });
      if (rows && rows[0]) {
        const upd = mapClient(rows[0]);
        upd.historico = currentClient.historico;
        currentClient = upd;
        if (upd.nome) document.getElementById('topbar-name').textContent = upd.nome.split(' ')[0];
      }
    } catch(e) { /* silencioso */ }
  }, 60000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NOTIFICA√á√ïES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function pedirPermissaoNotificacao() {
  if ('Notification' in window && Notification.permission === 'default') {
    Notification.requestPermission();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN PANEL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadAdminPanel() {
  show('appAdmin');
  adminTab('clientes', document.querySelector('#appAdmin .nav-item'));
}

function adminTab(tab, el) {
  document.querySelectorAll('#appAdmin .nav-item').forEach(n => n.classList.remove('active'));
  if (el) el.classList.add('active');
  if      (tab === 'clientes')    renderAdminClientes();
  else if (tab === 'novo')        renderAdminNovoCliente();
  else if (tab === 'estrategias') renderAdminEstrategias();
  else if (tab === 'config')      renderAdminConfig();
}

async function renderAdminClientes() {
  document.getElementById('adminMain').innerHTML = '<div class="empty"><div class="empty-icon">‚è≥</div>Carregando...</div>';
  const clientes = await getClients();
  if (!clientes.length) {
    document.getElementById('adminMain').innerHTML = '<div class="panel"><div class="empty"><div class="empty-icon">üë•</div>Nenhum cliente cadastrado.</div></div>';
    return;
  }
  const rows = clientes.map(c => `
    <tr onclick="abrirModalCliente('${c.id}')">
      <td style="font-family:'IBM Plex Mono',monospace;font-size:.68rem">${c.email}</td>
      <td>${c.nome||'‚Äî'}</td>
      <td style="font-size:.72rem">${c.plano||'‚Äî'}</td>
      <td><span class="badge ${c.status==='Ativo'?'active-badge':c.status==='Pendente'?'pending-badge':'inactive-badge'}"><span class="badge-dot"></span>${c.status||'Pendente'}</span></td>
      <td style="font-family:'IBM Plex Mono',monospace;color:var(--green)">${c.roi!=null?(c.roi>=0?'+':'')+c.roi+'%':'‚Äî'}</td>
      <td style="font-family:'IBM Plex Mono',monospace">${c.whats||'‚Äî'}</td>
    </tr>
  `).join('');
  document.getElementById('adminMain').innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem;margin-bottom:1rem">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:2px">CLIENTES <span style="font-size:1rem;color:var(--muted)">(${clientes.length})</span></div>
      <button class="btn btn-sm" onclick="adminTab('novo',null)">+ NOVO</button>
    </div>
    <div class="panel"><div class="tbl-wrap">
      <table>
        <thead><tr><th>Email</th><th>Nome</th><th>Plano</th><th>Status</th><th>ROI</th><th>WhatsApp</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>
    </div></div>
  `;
}

async function abrirModalCliente(id) {
  const clientes = await getClients();
  const c = clientes.find(x => x.id === id);
  if (!c) return;
  document.getElementById('modal-title').textContent = 'CLIENTE ‚Äî ' + (c.nome || c.email);
  document.getElementById('modal-body').innerHTML = `
    <div class="field"><label>Nome</label><input type="text" id="m-nome" value="${c.nome||''}"></div>
    <div class="field"><label>Email</label><input type="text" value="${c.email}" disabled style="opacity:.5"></div>
    <div class="field"><label>WhatsApp</label><input type="text" id="m-whats" value="${c.whats||''}"></div>
    <div class="field"><label>Plano</label>
      <select id="m-plano">
        <option value="">‚Äî</option>
        <option value="Telegram - R$97/m√™s" ${c.plano==='Telegram - R$97/m√™s'?'selected':''}>Telegram ¬∑ R$97/m√™s</option>
        <option value="Bot por Estrat√©gia - R$117 + 10%" ${c.plano==='Bot por Estrat√©gia - R$117 + 10%'?'selected':''}>Bot ¬∑ R$117 + 10%</option>
        <option value="Anual - R$1.997 + 15%" ${c.plano==='Anual - R$1.997 + 15%'?'selected':''}>Anual ¬∑ R$1.997 + 15%</option>
      </select>
    </div>
    <div class="field-row">
      <div class="field"><label>Status</label>
        <select id="m-status">
          <option value="Pendente" ${c.status==='Pendente'?'selected':''}>Pendente</option>
          <option value="Ativo" ${c.status==='Ativo'?'selected':''}>Ativo</option>
          <option value="Inativo" ${c.status==='Inativo'?'selected':''}>Inativo</option>
        </select>
      </div>
      <div class="field"><label>Bot Ativo</label>
        <select id="m-bot">
          <option value="false" ${!c.bot_ativo?'selected':''}>N√£o</option>
          <option value="true" ${c.bot_ativo?'selected':''}>Sim</option>
        </select>
      </div>
    </div>
    <div class="field-row">
      <div class="field"><label>ROI (%)</label><input type="number" id="m-roi" value="${c.roi||0}" step="0.1"></div>
      <div class="field"><label>Lucro (R$)</label><input type="number" id="m-lucro" value="${c.lucro||0}" step="0.01"></div>
    </div>
    <div class="field"><label>Ops</label><input type="number" id="m-ops" value="${c.ops||0}"></div>
    <div class="field"><label>Nota interna</label><input type="text" id="m-nota" value="${c.nota||''}" placeholder="Observa√ß√µes..."></div>
    <div class="field"><label>Senha (deixar em branco para n√£o alterar)</label><input type="text" id="m-senha" placeholder="nova senha..."></div>
    <div class="err" id="m-err"></div>
    <button class="btn" onclick="salvarClienteAdmin('${c.id}')">üíæ SALVAR</button>
    <button class="btn btn-danger" style="margin-top:.5rem" onclick="excluirCliente('${c.id}')">üóë EXCLUIR</button>
  `;
  document.getElementById('modalCliente').classList.add('open');
}

async function salvarClienteAdmin(id) {
  const senhaNova = document.getElementById('m-senha').value;
  const patch = {
    nome:      document.getElementById('m-nome').value.trim(),
    whats:     document.getElementById('m-whats').value.trim(),
    plano:     document.getElementById('m-plano').value,
    status:    document.getElementById('m-status').value,
    bot_ativo: document.getElementById('m-bot').value === 'true',
    roi:       parseFloat(document.getElementById('m-roi').value)||0,
    lucro:     parseFloat(document.getElementById('m-lucro').value)||0,
    ops:       parseInt(document.getElementById('m-ops').value)||0,
    nota:      document.getElementById('m-nota').value.trim(),
  };
  if (senhaNova) patch.senha = senhaNova;
  try {
    await sb.update('clientes', id, patch);
    showToast('‚úì Cliente atualizado!');
    closeModal();
    renderAdminClientes();
  } catch(e) {
    document.getElementById('m-err').textContent='Erro ao salvar.';
    document.getElementById('m-err').classList.add('show');
  }
}

async function excluirCliente(id) {
  if (!confirm('Excluir este cliente? A√ß√£o irrevers√≠vel.')) return;
  try {
    await sb.delete('clientes', id);
    showToast('Cliente exclu√≠do.');
    closeModal();
    renderAdminClientes();
  } catch(e) { showToast('Erro ao excluir.', true); }
}

function renderAdminNovoCliente() {
  document.getElementById('adminMain').innerHTML = `
    <div style="font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:2px;margin-bottom:1rem">NOVO CLIENTE</div>
    <div class="panel" style="max-width:500px">
      <div class="field"><label>Email *</label><input type="email" id="nc-email" placeholder="email@exemplo.com"></div>
      <div class="field"><label>Senha inicial *</label><input type="text" id="nc-senha" value="mudar123"></div>
      <div class="field"><label>Nome</label><input type="text" id="nc-nome"></div>
      <div class="field"><label>WhatsApp</label><input type="text" id="nc-whats"></div>
      <div class="field"><label>Plano</label>
        <select id="nc-plano">
          <option value="">Selecione...</option>
          <option value="Telegram - R$97/m√™s">Telegram ¬∑ R$97/m√™s</option>
          <option value="Bot por Estrat√©gia - R$117 + 10%">Bot ¬∑ R$117 + 10%</option>
          <option value="Anual - R$1.997 + 15%">Anual ¬∑ R$1.997 + 15%</option>
        </select>
      </div>
      <div class="err" id="nc-err"></div>
      <button class="btn" onclick="criarClienteAdmin()">‚ûï CRIAR CLIENTE</button>
    </div>
  `;
}

async function criarClienteAdmin() {
  const email = document.getElementById('nc-email').value.trim().toLowerCase();
  const senha = document.getElementById('nc-senha').value;
  const nome  = document.getElementById('nc-nome').value.trim();
  const whats = document.getElementById('nc-whats').value.trim();
  const plano = document.getElementById('nc-plano').value;
  const errEl = document.getElementById('nc-err');
  errEl.classList.remove('show');
  if (!email||!senha) { errEl.textContent='Email e senha obrigat√≥rios.'; errEl.classList.add('show'); return; }
  try {
    await sb.insert('clientes', {
      email, senha, nome, whats, plano, banca:0,
      bf_login:'', bf_senha:'', status:'Pendente', bot_ativo:false,
      roi:0, lucro:0, ops:0,
      vencimento: new Date(Date.now()+30*24*60*60*1000).toISOString()
    });
    showToast('‚úì Cliente criado! Senha: ' + senha);
    adminTab('clientes', document.querySelector('#appAdmin .nav-item'));
  } catch(e) {
    errEl.textContent = e.message.includes('duplicate') ? 'Email j√° cadastrado.' : 'Erro ao criar.';
    errEl.classList.add('show');
  }
}

function renderAdminEstrategias() {
  document.getElementById('adminMain').innerHTML = `
    <div style="font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:2px;margin-bottom:1rem">ESTRAT√âGIAS</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem">
      ${ESTRATEGIAS.map(e=>`
        <div class="panel">
          <div style="font-size:2rem;margin-bottom:.5rem">${e.icone}</div>
          <div style="font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:2px">${e.nome}</div>
          <div style="font-family:'IBM Plex Mono',monospace;font-size:.6rem;color:var(--muted);margin-bottom:.5rem">${e.mercado}</div>
          <div style="font-size:.78rem;color:var(--muted2);line-height:1.6">${e.desc}</div>
        </div>
      `).join('')}
    </div>
  `;
}

function renderAdminConfig() {
  document.getElementById('adminMain').innerHTML = `
    <div style="font-family:'Bebas Neue',sans-serif;font-size:1.6rem;letter-spacing:2px;margin-bottom:1rem">CONFIGURA√á√ïES</div>
    <div class="panel" style="max-width:500px">
      <div class="panel-title">Sistema</div>
      <div class="info-row"><span class="info-label">Chave PIX</span><span class="info-val" style="font-size:.65rem;word-break:break-all">${PIX_KEY}</span></div>
      <div class="info-row"><span class="info-label">WhatsApp Admin</span><span class="info-val">+${WPP_ADMIN}</span></div>
      <div class="info-row"><span class="info-label">Valor Bot</span><span class="info-val">R$ ${VALOR_BOT}</span></div>
      <div class="info-row"><span class="info-label">Supabase</span><span class="info-val" style="color:var(--green)">‚óè Conectado</span></div>
    </div>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT ‚Äî verifica sess√£o salva ao carregar a p√°gina
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(async function init() {
  const session = getSession();
  if (!session) { showLogin(); return; }

  if (session.type === 'admin') {
    loadAdminPanel();
    return;
  }

  if (session.type === 'client' && session.id) {
    try {
      const rows = await sb.get('clientes', { id: session.id });
      if (rows && rows[0]) {
        const hist = await sb.get('historico', { cliente_id: session.id }).catch(() => []);
        const c = mapClient(rows[0]);
        c.historico = (hist||[]).map(h => ({ data:h.data, banca:h.banca, lucro:h.lucro, roi:h.roi }));
        loadClientDashboard(c);
        conectarRealtime(session.id);
        const planoUrl = new URLSearchParams(window.location.search).get('plano');
        if (planoUrl) {
          setTimeout(() => {
            const nav = [...document.querySelectorAll('#appClient .nav-item')].find(el => el.textContent.includes('Planos'));
            if (nav) clientTab('planos', nav);
          }, 400);
        }
        return;
      }
    } catch(e) { /* sess√£o inv√°lida */ }
    clearSession();
  }
  showLogin();
})();

